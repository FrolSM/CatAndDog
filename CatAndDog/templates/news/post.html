{% extends 'flatpages/default.html' %}
{% load news_filters %}

{% block title %}{{ post.title }}{% endblock %}
{% block content %}
    <div class="postdeteil">
        <h1>{{ post.title }}</h1>
        <p>–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{ post.category }} –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {{ post.author }}<br> –î–∞—Ç–∞: {{ post.time }}</p>
        {% if post.photo %}
            <img class="img-article-left" src="{{ post.photo.url }}">
        {% endif %}
        {% if post.video %}
            <video class="video" controls src="{{ post.video.url }}"></video>
        {% endif %}
        <h5>{{ post.text|censor }}</h5>
        <div class="like">
                <button class="like-btn" data-post-id="{{ post.id }}">
                    {% if request.user in post.liked_users %}
                        –£–±—Ä–∞—Ç—å –ª–∞–π–∫
                    {% else %}
                        –õ–∞–π–∫ üëç
                    {% endif %}
                </button>

                <span class="like-count" data-post-id="{{ post.id }}">
                    {{ post.like_count }}
                </span>

            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
            <script>
            $(document).ready(function() {
                $('.like-btn').click(function() {
                    var postId = $(this).data('post-id');
                    $.ajax({
                        url: `/post/${postId}/like/`,
                        type: 'POST',
                        headers: {'X-CSRFToken': '{{ csrf_token }}'},
                        success: function(response) {
                            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
                            $(`.like-btn[data-post-id="${postId}"]`).text(
                                response.liked ? '–£–±—Ä–∞—Ç—å –ª–∞–π–∫' : '–õ–∞–π–∫ üëç'
                            );
                            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á—ë—Ç—á–∏–∫
                            $(`.like-count[data-post-id="${postId}"]`).text(response.count);
                        }
                    });
                });
            });
            </script>
            <a href="{% url 'post_comment' post.pk %}"> –ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å <i class="fa-regular fa-comment"></i></a>
        </div>
        <br>
        <div class="comment">
            {% if post.comment_set %}
                <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:</h3>
                <hr>
                {% for comment in post.comment_set.all %}
                <p> –ê–≤—Ç–æ—Ä –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è: "{{ comment.user }}" –í—Ä–µ–º—è: {{ comment.time_comm }}</p>
                <h5> {{ comment.text|censor }}</h5>
                {% if not forloop.last %}
                    <hr>
                {% endif %}
                {% endfor %}
            {% else %}
                <p class="no-comments">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
            {% endif %}
        </div>
    </div>
{% endblock content %}