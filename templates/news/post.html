{% extends 'flatpages/default.html' %}
{% load news_filters %}

{% block title %}{{ post.title }}{% endblock %}

{% block content %}
<div class="postdeteil">
    <h1>{{ post.title }}</h1>
    <p>–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{ post.category }} | –ê–≤—Ç–æ—Ä: {{ post.author }} | –î–∞—Ç–∞: {{ post.time }}</p>

    {% if post.media.exists %}
        {% for m in post.media.all %}
            {% if m.media_type == 'photo' %}
                <img class="img-article-left" src="{{ m.file.url }}" alt="{{ post.title }}">
            {% elif m.media_type == 'video' %}
                <video class="video" controls>
                    <source src="{{ m.file.url }}" type="video/mp4">
                    –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
                </video>
            {% endif %}
        {% endfor %}
    {% else %}
        <p>–ú–µ–¥–∏–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</p>
    {% endif %}



    <h5>{{ post.text|censor }}</h5>

    <!-- –õ–∞–π–∫–∏ -->
    <div class="like">
        <button class="like-btn" data-post-slug="{{ post.slug }}">
            {% if request.user in post.liked_users %}
                –£–±—Ä–∞—Ç—å –ª–∞–π–∫
            {% else %}
                –õ–∞–π–∫ üëç
            {% endif %}
        </button>

        <span class="like-count" data-post-slug="{{ post.slug }}">
            {{ post.like_count }}
        </span>

        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
        $(document).ready(function() {
            $('.like-btn').click(function() {
                var slug = $(this).data('post-slug');

                $.ajax({
                    url: `/post/${slug}/like/`,
                    type: 'POST',
                    headers: {'X-CSRFToken': '{{ csrf_token }}'},
                    success: function(response) {
                        $(`.like-btn[data-post-slug="${slug}"]`).text(
                            response.liked ? '–£–±—Ä–∞—Ç—å –ª–∞–π–∫' : '–õ–∞–π–∫ üëç'
                        );
                        $(`.like-count[data-post-slug="${slug}"]`).text(response.count);
                    }
                });
            });
        });
        </script>

        <a href="{% url 'post_comment' post.slug %}"> –ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å <i class="fa-regular fa-comment"></i></a>
        {% if post.author == request.user or request.user.is_staff %}
            <a href="{% url 'post_update' post.slug %}"> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å <i class="fa-regular fa-pen-to-square"></i></a>
        {% endif %}
        {% if request.user.is_staff %}
            <a href="{% url 'post_delete' post.slug %}"> –£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç <i class="fa-solid fa-delete-left"></i></a>
        {% endif %}
    </div>

    <br>

    <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
    <div class="comment">
        {% if post.comment_set.exists %}
            <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:</h3>
            <hr>
            {% for comment in post.comment_set.all %}
                <p>–ê–≤—Ç–æ—Ä –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è: "{{ comment.author_comm }}" | –í—Ä–µ–º—è: {{ comment.time_comm }}</p>
                <h5>{{ comment.text|censor }}</h5>
                {% if comment.author_comm == request.user or request.user.is_staff %}
                <div class="update_or_delete_comm">
                    <a href="{% url 'post_comment_update' post.slug comment.pk %}" >–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                    <a href="{% url 'comment_delete' post.slug comment.pk %}" >–£–¥–∞–ª–∏—Ç—å</a>
                </div>
                {% endif %}
                {% if not forloop.last %}
                    <hr>
                {% endif %}
            {% endfor %}
        {% else %}
            <p class="no-comments">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
        {% endif %}
    </div>
</div>
{% endblock content %}